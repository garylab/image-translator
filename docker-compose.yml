services:
  web:
    build: .
    env_file:
      - .env
    ports:
      - 8033:8000
    environment:
      - TOR_ENABLED=true
      - TOR_SOCKS_PROXY=socks5://tor:9050
      - HEADLESS=false
    command: ["/bin/sh", "-c", "xvfb-run --auto-servernum --server-args='-screen 0 1920x1080x24' uvicorn src.api:app --host 0.0.0.0 --port 8000"]

  tor:
    image: dperson/torproxy
    restart: unless-stopped
    environment:
      - TOR_NewCircuit=10  # New circuit every 30 seconds for IP rotation
    # ports:
    #   - 9050:9050  # SOCKS5 proxy (uncomment to expose externally)
    #   - 9051:9051  # Tor control port

